<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Leitor de Odds Betano v2</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #0b1324;
    color: #fff;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  h1 {
    color: gold;
  }
  input {
    width: 90%;
    max-width: 600px;
    padding: 10px;
    border: 2px solid gold;
    border-radius: 8px;
    background: #111827;
    color: #fff;
    font-size: 16px;
  }
  button {
    margin-top: 10px;
    padding: 10px 20px;
    background: gold;
    border: none;
    border-radius: 8px;
    color: #111827;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover { background: #facc15; }
  pre {
    background: #111827;
    border: 1px solid #334155;
    border-radius: 8px;
    padding: 15px;
    text-align: left;
    white-space: pre-wrap;
    word-wrap: break-word;
    margin-top: 20px;
  }
</style>
</head>
<body>
<h1>üèÜ Leitor de Odds Betano v2</h1>
<p>Cole o link completo da partida Betano:</p>

<input id="link" placeholder="https://www.betano.bet.br/...">
<br>
<button id="ler">üîç Ler P√°gina</button>
<button id="baixar" style="display:none;">üíæ Baixar .txt</button>

<pre id="saida">Aguardando link...</pre>

<script>
const proxies = [
  "https://api.allorigins.win/get?url=",
  "https://corsproxy.io/?",
  "https://api.codetabs.com/v1/proxy/?quest="
];

document.getElementById("ler").addEventListener("click", async () => {
  const url = document.getElementById("link").value.trim();
  const saida = document.getElementById("saida");
  const btnBaixar = document.getElementById("baixar");
  if (!url) return alert("Cole o link da partida da Betano!");

  saida.textContent = "‚è≥ Lendo p√°gina, aguarde...";
  btnBaixar.style.display = "none";

  let html = "";
  for (const proxy of proxies) {
    try {
      const resp = await fetch(proxy + encodeURIComponent(url));
      if (!resp.ok) continue;
      const data = await resp.text();
      html = data.includes("{\"contents\"") ? JSON.parse(data).contents : data;
      if (html.includes("Betano")) break;
    } catch (e) { console.warn("Proxy falhou:", proxy); }
  }

  if (!html) {
    saida.textContent = "‚ùå N√£o foi poss√≠vel acessar a p√°gina. A Betano pode estar bloqueando proxies.";
    return;
  }

  const doc = new DOMParser().parseFromString(html, "text/html");

  const titulo = doc.querySelector("title")?.textContent?.trim() || "Jogo";
  const dataJogo = doc.body.textContent.match(/\d{1,2}\s\w+\s\d{4}|\d{1,2}\/\d{1,2}\/\d{4}/)?.[0] || "Data n√£o encontrada";

  const oddsBtns = doc.querySelectorAll('[data-qa="odd-button"]');
  if (!oddsBtns.length) {
    saida.textContent = "‚ö†Ô∏è Nenhuma odd encontrada. O conte√∫do pode carregar dinamicamente.";
    return;
  }

  const mercados = {};
  oddsBtns.forEach(btn => {
    const mercado = btn.closest('[data-qa="market-card"]')?.querySelector('[data-qa="market-name"]')?.textContent?.trim()
      || btn.closest('[data-qa="market-group"]')?.querySelector('[data-qa="market-name"]')?.textContent?.trim()
      || "Mercado";
    const nome = btn.querySelector('[data-qa="odd-name"]')?.textContent?.trim()
      || btn.querySelector("span")?.textContent?.trim() || "Op√ß√£o";
    const odd = btn.querySelector('[data-qa="odd-price"]')?.textContent?.trim()
      || btn.textContent.match(/[0-9]+\.[0-9]+/)?.[0] || "";
    if (!mercados[mercado]) mercados[mercado] = [];
    mercados[mercado].push(`${nome}: ${odd}`);
  });

  let texto = `üìÑ Odds extra√≠das de: ${url}\nüèüÔ∏è ${titulo}\nüìÖ ${dataJogo}\n\n`;
  for (const [mercado, lista] of Object.entries(mercados)) {
    texto += `üè∑Ô∏è ${mercado}\n`;
    lista.forEach(l => texto += `‚Ä¢ ${l}\n`);
    texto += "\n";
  }

  saida.textContent = texto;
  btnBaixar.style.display = "inline-block";

  btnBaixar.onclick = () => {
    const blob = new Blob([texto], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = (titulo.replace(/\s+/g, "_") || "odds") + ".txt";
    a.click();
    URL.revokeObjectURL(a.href);
  };
});
</script>
</body>
</html>
