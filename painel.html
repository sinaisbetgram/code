// === Painel Betgram â€” Envio + EdiÃ§Ã£o Unificado (v4 Gold) ===
(function painelBetgramCompleto() {
  console.log("ğŸ† Painel Betgram Completo iniciado...");

  if (document.getElementById("painelBetgramCompleto")) {
    console.warn("âš ï¸ Painel jÃ¡ existe.");
    return;
  }

  // === CONFIGURAÃ‡Ã•ES DO TELEGRAM ===
  const token = "8389689778:AAFxqYCPj-w2M5hWhRxuXvRjhvc8zLw7Djw";
  const chatId = "-1003073897767";

  // === CRIAR PAINEL ===
  const painel = document.createElement("div");
  painel.id = "painelBetgramCompleto";
  Object.assign(painel.style, {
    position: "fixed",
    bottom: "20px",
    right: "20px",
    width: "260px",
    background: "rgba(11,19,36,0.97)",
    border: "2px solid gold",
    borderRadius: "12px",
    color: "#fff",
    fontFamily: "monospace",
    padding: "10px",
    zIndex: 999999,
    boxShadow: "0 0 15px rgba(255,215,0,0.4)"
  });

  painel.innerHTML = `
    <h3 style="margin:0 0 8px;font-size:15px;">ğŸ“¤ Enviar Aposta</h3>
    <input type="file" id="uploadImg" accept="image/*"
      style="width:100%;margin-bottom:10px;background:#111827;border:1px solid #334155;color:white;padding:4px;border-radius:6px;">
    <button id="btn05" style="background:#facc15;border:none;border-radius:8px;color:#111;font-weight:bold;width:100%;padding:8px;margin-bottom:6px;cursor:pointer;">âš ï¸ 0,5% Risco</button>
    <button id="btn1" style="background:#22c55e;border:none;border-radius:8px;color:white;font-weight:bold;width:100%;padding:8px;margin-bottom:6px;cursor:pointer;">ğŸ’¡ 1% ConfianÃ§a</button>
    <button id="btn2" style="background:#3b82f6;border:none;border-radius:8px;color:white;font-weight:bold;width:100%;padding:8px;margin-bottom:6px;cursor:pointer;">ğŸ”¥ 2% Alta</button>
    <button id="btnVer" style="background:#ef4444;border:none;border-radius:8px;color:white;font-weight:bold;width:100%;padding:8px;margin-bottom:6px;cursor:pointer;">ğŸ” Ver Aposta</button>
    <p id="statusEnvio" style="font-size:12px;margin-top:6px;text-align:center;">ğŸ•“ Aguardando envio...</p>
    <hr style="border:1px solid #334155;margin:8px 0;">
    <label style="font-size:13px;">ğŸ§¾ ID para editar:</label>
    <input id="msgId" type="number" placeholder="Ex: 258" style="width:100%;margin-bottom:8px;background:#111827;border:1px solid #334155;color:white;padding:4px;border-radius:6px;">
    <button id="ganhei" style="background:#22c55e;color:white;font-weight:bold;width:48%;padding:6px;border:none;border-radius:6px;cursor:pointer;">âœ… Ganhei</button>
    <button id="perdi" style="background:#ef4444;color:white;font-weight:bold;width:48%;padding:6px;border:none;border-radius:6px;cursor:pointer;">âŒ Perdi</button>
  `;
  document.body.appendChild(painel);

  const input = painel.querySelector("#uploadImg");
  const status = painel.querySelector("#statusEnvio");
  const msgIdInput = painel.querySelector("#msgId");

  // === Salvar histÃ³rico local ===
  const sinais = JSON.parse(localStorage.getItem("sinaisEnviados") || "[]");
  function salvar(id, caption) {
    sinais.push({ id, caption, data: new Date().toLocaleString("pt-BR") });
    localStorage.setItem("sinaisEnviados", JSON.stringify(sinais));
  }

  // === FunÃ§Ã£o para enviar imagem ===
  async function enviarImagem(caption) {
    const arquivo = input.files[0];
    if (!arquivo) {
      alert("ğŸ“ Selecione uma imagem antes de enviar!");
      return;
    }

    status.textContent = "â³ Enviando...";
    status.style.color = "#9ca3af";

    try {
      const form = new FormData();
      form.append("chat_id", chatId);
      form.append("photo", arquivo);
      form.append("caption", caption);
      form.append("parse_mode", "Markdown");

      const resp = await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
        method: "POST",
        body: form
      });
      const data = await resp.json();

      if (data.ok) {
        const msgId = data.result.message_id;
        salvar(msgId, caption);
        status.textContent = `âœ… Enviado com sucesso! (ID ${msgId})`;
        status.style.color = "#22c55e";
        msgIdInput.value = msgId;
      } else {
        status.textContent = "âŒ Erro: " + data.description;
        status.style.color = "#ef4444";
      }
    } catch (e) {
      status.textContent = "âš ï¸ Falha: " + e.message;
      status.style.color = "#ef4444";
    }
  }

  // === FunÃ§Ã£o para editar mensagem ===
  async function editarLegenda(id, novaLegenda) {
    if (!id) return alert("Digite o ID da mensagem!");
    status.textContent = "âœï¸ Editando...";
    try {
      const resp = await fetch(`https://api.telegram.org/bot${token}/editMessageCaption`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          message_id: parseInt(id),
          caption: novaLegenda,
          parse_mode: "Markdown"
        })
      });
      const data = await resp.json();
      if (data.ok) {
        status.textContent = "âœ… Editado com sucesso!";
        status.style.color = "#22c55e";
      } else {
        status.textContent = "âŒ Erro ao editar: " + data.description;
        status.style.color = "#ef4444";
      }
    } catch (err) {
      status.textContent = "âš ï¸ Erro: " + err.message;
      status.style.color = "#ef4444";
    }
  }

  // === BotÃµes principais ===
  painel.querySelector("#btn05").onclick = () =>
    enviarImagem("âš ï¸ *Entrada leve â€” 0,5% da banca.*\nOdd de valor, mas com risco.");

  painel.querySelector("#btn1").onclick = () =>
    enviarImagem("ğŸ’¡ *Entrada padrÃ£o â€” 1% da banca.*\nConfianÃ§a moderada.");

  painel.querySelector("#btn2").onclick = () =>
    enviarImagem("ğŸ”¥ *Entrada forte â€” 2% da banca.*\nAlta confianÃ§a!");

  painel.querySelector("#btnVer").onclick = () =>
    window.open("https://www.betano.bet.br/myaccount/bethistory/open", "_blank");

  painel.querySelector("#ganhei").onclick = () =>
    editarLegenda(msgIdInput.value, "âœ… *Aposta VENCIDA!* ğŸŸ¢");

  painel.querySelector("#perdi").onclick = () =>
    editarLegenda(msgIdInput.value, "âŒ *Aposta PERDIDA!* ğŸ”´");
})();
